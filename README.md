# Keyboard layout evaluation

An evaluation of existing keyboard layouts over multiple languages, focused on ergonomic keyboards.

Many keyboard layouts are designed (by hand or generated by an algorithm) to improve the ergonomics of Qwerty. However, they are typically assessed for typing in a single language, and on a standard keyboard. This analysis evaluates those layouts over several languages, and for an ergonomic keyboard.

The method uses statistics of bigram use (sets of 2 letters) for each language, and grades them according to subjective "weights" (depending on the keys positions), to calculate a comparative difficulty between layouts.

It is focused on writing text, not code. Programming requires special characters more suited to an additional layer; this script focuses on the base layer. Also, no attempt was made to generate a new "optimum" layout, as there would be a lot of variation depending on subjective parameters. Existing layouts already perform very well here, including some generated ones.

The results show that any alternative layout gives a significant ergonomic advantage over Qwerty. Several options give good results, in particular [Colemak DHm](https://colemakmods.github.io/mod-dh/keyboards.html) which also brings good familiarity, accessible shortcuts, and positive user feedback.

![results](layout_evaluation/results.png "Grades per layout")

This project has also been modified and used [here](http://thedarnedestthing.com/keyboard%20layout%20evaluation).

# Table of contents

- [Keyboard layout evaluation](#keyboard-layout-evaluation)
- [Table of contents](#table-of-contents)
- [Character statistics](#character-statistics)
  - [count.py](#countpy)
  - [Spreadsheet analysis](#spreadsheet-analysis)
    - [Character counts](#character-counts)
    - [Bigram counts](#bigram-counts)
  - [Punctuation](#punctuation)
  - [Takeaway](#takeaway)
- [Layout evaluation](#layout-evaluation)
  - [Focus definition](#focus-definition)
  - [Evaluation principle](#evaluation-principle)
    - [Key base weights](#key-base-weights)
    - [Penalties](#penalties)
  - [Limits](#limits)
    - [Bigram frequencies variations](#bigram-frequencies-variations)
    - [Accented characters](#accented-characters)
  - [script.py](#scriptpy)
  - [Results](#results)
- [Conclusion](#conclusion)

# Character statistics

Contained in folder `character_stats`.

The [layout evaluation](#layout-evaluation) needs bigram frequencies (sets of 2 letters) for each language.

The frequencies come from [Practical Cryptography](http://practicalcryptography.com/cryptanalysis/letter-frequencies-various-languages/) for English, French, Spanish, German, and Swedish; and from [Norvig](http://norvig.com/mayzner.html) for English (to compare).

For comparison, my own corpus is also analyzed (for English and French); made of my emails, some texts from free books, and some internet articles.

## count.py

Requirements: Python 3, Pandas.

The script `count.py` takes the text files in the `data` folder and outputs the character counts in `chars.csv`, and the bigram counts in `bigrams.csv`. Upper case is converted to lower case.

The list of characters to take into account is configurable in the code, in the list `chars`. Currently it takes the basic alphabet, plus `éèêàçâîô.,-'/`. 

The provided `chars.csv` and `bigrams.csv` files were generated with a personal corpus of emails (`mails_en` and `mails_fr`, 300\~400kB of raw text each) and various free books and articles (`vrac_en` and `vrac_fr`, 200\~400kB each).

## Spreadsheet analysis

This analysis is done in the Libreoffice spreadsheet `stats.ods`.

### Character counts

The character frequencies for both English and French are quite consistent between the sources and my own corpus.

![chars_en](images/chars_en.png "Character occurences in corpus, English")

[Here](images/chars_fr.png) is the same chart for French.

### Bigram counts

The bigram counts show more discrepancies. The charts below show the top 80 bigrams (sorted by the average of both sources for English).

![bigram_en](images/bigram_en.png "Bigram occurences in corpus, English")

[Here](images/bigram_fr.png) is the same chart for French.

## Punctuation

The "theory" numbers from Practical Cryptography and Norvig do not contain data on punctuation characters such as `.,-'/`. However while the use of `.` and `,` depend a lot on each author's style, taking into account a non-zero frequency is essential due to their frequency.

The relevant bigram frequencies are not present in any existing statistics, but for French [the Bépo layout project](https://bepo.fr/wiki/Fr%C3%A9quence_des_caract%C3%A8res) gives character frequencies from a Wikipedia 2008 dump.

For English, [Vivian Cook's analysis](http://www.viviancook.uk/Punctuation/PunctFigs.htm) gives frequencies by word. [This University of Maryland paper](http://www.cs.umd.edu/hcil/trs/2013-17/2013-17.pdf) (Table 1) gives a frequency for `.` of 1.151% (from Google Ngram data).

The frequencies from the personal corpus contain those characters so it can be used as a control. However, it is useful to have more realistic "theory" results. The approach is to "fix" the missing frequencies by copying the relevant ones from the personal corpus and normalizing the column.

To check that those inputs make sense, they can be compared to the few data available.

For English, we can estimate by dividing the frequencies from Vivian Cook by the average word length of 4.79 letters (from Norvig).

| For English | Personal corpus | Frequency / Word length | Google Ngram |
| :---------- | --------------: | ----------------------: | -----------: |
| Period .    |           1.6 % |                  1.36 % |      1.151 % |
| Comma ,     |           1.2 % |                  1.29 % |              |

| For French | Personal corpus | Wikipedia dump |
| :--------- | --------------: | -------------: |
| Period .   |           1.2 % |         0.83 % |
| Comma ,    |           1.5 % |         1.02 % |

Some variation can be observed, but the numbers from the personal corpus pass that sanity check. It seems a bit more punctuation is used compared to the average literature, which isn't bad to consider.

## Takeaway

For the evaluation, the "theory" numbers will be the average from both sources for English, and the only source I have for other languages. But the differences with my own corpus show the sensitivity of those inputs, therefore the results should be taken with some tolerance.

As the "theory" numbers do not contain characters such as `.,-'/`, those will be copied from the personal corpus data then normalized.

# Layout evaluation

Contained in folder `layout_evaluation`.

## Focus definition

The influence of the physical keyboard is on the weights and penalties. The algorithm is more or less the same otherwise.

The chosen weights are for an ergonomic keyboard, so they are symmetrical. It would be similar for any non-staggered keyboard (no horizontal shift between rows).

Only the keys on the main 3×12 matrix are taken into account, which are reachable by a finger easily. The "numbers" row is ignored as we focus on the alphabetical layout.

Thumb keys available on ergonomic keyboards are ignored as I arbitrarily prefer not to place any alphanumeric character on them.

![layout_matrix](images/layout_matrix.svg "Keys names on matrix layout")

The keys are designated by a code (hand, row, column). The numbering includes space for some currently-unused keys, in case of evolution (like for [an Ergodox-like keyboard](images/layout_ergodox.svg)).

## Evaluation principle

For each language, the bigram frequencies are imported from the character statistics, as a percentage of use.

The principle is to assign a difficulty (weight) to a bigram (two keys typed consecutively). The bigram weight is multiplied by its frequency, and all the results are summed up to get a general difficulty value of the layout.

Weight<sub>layout</sub> = sum( Weight<sub>bigram</sub> × Probability<sub>bigram</sub> )

The bigram weight is composed of:
- The weights assigned to the two keys, representing the relative difficulty to push them individually
- A penalty, representing the added difficulty of pushing those 2 keys one after the other

Weight<sub>bigram</sub> = Weight<sub>key1</sub> + Weight<sub>key2</sub> + Penalty<sub>key1 & key2</sub>

The results for all layouts and languages are finally normalized compared to Qwerty in English (at 100%).

### Key base weights

The base weights are shown below. The home row is identified by a red border. 

They represent the relative difficulty to hit a single key. The proposed values are for an ergonomic keyboard, with vertical columns and a comfortable home row position.

![weights](images/weights.png "Keys weights")

### Penalties

The penalties represent the additional difficulty of hitting 2 keys consecutively. They come on top of the base weight. They are only taken into account if the 2 keys are hit by the same hand (and are not the same key, like "aa"). By default, they are given a slightly positive value in order to favor hand alternation.

Generally, the penalties are higher if the same finger is used, and  the more rows separate the 2 keys. They can be negative if the relative position makes the motion easy, such as a close "inward roll" (like "sd" on Qwerty).

| First finger | Second finger | Same row | 1 row jump | 2 rows jump | Comment     |
| :----------- | :------------ | -------: | ---------: | ----------: | :---------- |
| Index        | Index         |      2.5 |        3.5 |         4.5 | Same finger |
| Index        | Middle        |      0.5 |        1.0 |         2.0 |
| Index        | Ring          |      0.5 |        0.8 |         1.5 |
| Index        | Pinky         |      0.5 |        0.8 |         1.1 |
| Middle       | Index         |     -1.5 |       -0.5 |         1.5 | Inward roll |
| Middle       | Middle        |      N/A |        3.5 |         4.5 | Same finger |
| Middle       | Ring          |      0.5 |        1.0 |         2.0 |
| Middle       | Pinky         |      0.5 |        0.8 |         1.5 |
| Ring         | Index         |     -1.5 |       -0.5 |         1.5 | Inward roll |
| Ring         | Middle        |     -2.0 |       -0.5 |         1.2 | Inward roll |
| Ring         | Ring          |      N/A |        3.5 |         4.5 | Same finger |
| Ring         | Pinky         |      1.0 |        1.5 |         2.5 |
| Pinky        | Index         |     -1.0 |        0.0 |         1.0 | Inward roll |
| Pinky        | Middle        |     -1.0 |        0.0 |         1.5 | Inward roll |
| Pinky        | Ring          |     -1.0 |        0.0 |         1.5 | Inward roll |
| Pinky        | Pinky         |      3.0 |        4.0 |         5.5 | Same finger |

## Limits

### Bigram frequencies variations

The results are approximate as the bigram frequencies aren't a precise and objective number for everyone. 

However, the results for [English](layout_evaluation/results_en.png) and [French](layout_evaluation/results_fr.png) show very little difference between the "theory" values and my personal corpus. Therefore it seems the variation in bigram use doesn't affect the final grade very significantly.

### Accented characters

The results for languages outside English are slightly off because most accented characters are not taken into account. 

Currently, the ignored characters are `êàçâîôñäöüß/å`, mainly because those characters are absent from most considered layouts. The characters `é` and `è` were added manually to the layouts (on unused keys, on the vowel side if there's one) because I particularly care about French, and due to their high frequency (2.85%).

The characters `'` and `-` were also added when missing, on unused keys.

The issue mainly affects German (`äöüß`, 1.56% of the characters), Swedish (`äöå`, 4.45%), but also French (`êàçâîô`, 0.75%) and Spanish (`ñ`, 0.22%).

To mitigate this, the bigram frequencies are normalized after removing the ignored characters, so the summed grade is still calculated over 100%.

## script.py

Requirements: Python 3, Pandas, Matplotlib.

`script.py` uses the bigram statistics from `stats.csv`, and `config.txt` (key weights, penalties, and layouts definitions) to generate the results (table and plot).

To customize the script, edit `config.txt` and have a look at the `main()` function.

The code isn't very efficient as it iterates through dataframes to generate the results. In practice it executes in \~10s so it doesn't really matter.

## Results

Here are the full results, for all languages and including my personal corpus for English and French.

![results](layout_evaluation/results_full.png "Grades per layout")

Results for English only.

![results](layout_evaluation/results_en.png "Grades per layout")

Results for English only sorted by no punctuation.

![results](layout_evaluation/results_en_nopunctuation.png "Grades per layout")

Avgerage of all results.

![results](layout_evaluation/results_full_avg.png "Grades per layout")

Here is the complete results list. The layouts can be seen in `config.txt`.

| Layout | English | English perso | English No Punctuation | English Avg | French | French perso | Spanish | German | Swedish | Full Avg |
| :-------------------------------------------------------------------------------------------------------------------------------------------- | ------: | ------------: | -----: | -----------: | ------: | -----: | ------: | ------: | ------: | ------: |
| MTGAP | 64.48 | 63.16 | 63.63 | 63.756667 | 66.72 | 66.82 | 66.14 | 67.15 | 67.38 | 66.239333 |
| BEAKL 19bis | 64.51 | 63.46 | 63.81 | 63.926667 | 65.42 | 64.62 | 64.45 | 67.92 | 69.00 | 66.063333 |
| Engram 2.0/Engram Mod | 64.58 | 63.31 | 63.61 | 63.833333 | 67.95 | 67.72 | 66.52 | 69.11 | 69.47 | 67.353667 |
| Colemak DHm | 64.66 | 64.30 | 63.44 | 64.133333 | 64.82 | 64.81 | 64.18 | 64.70 | 68.16 | 65.197667 |
| Capewell | 64.77 | 64.58 | 64.62 | 64.656667 | 62.99 | 62.08 | 65.85 | 66.88 | 67.77 | 65.538333 |
| The-1 | 64.80 | 63.19 | 63.32 | 63.770000 | 69.74 | 69.45 | 68.97 | 67.54 | 70.26 | 68.027000 |
| Hieamtsrn | 64.90 | 64.09 | 64.31 | 64.433333 | 67.07 | 66.37 | 65.86 | 67.24 | 68.30 | 66.510667 |
| MTGAP 2.0 | 64.91 | 64.43 | 63.29 | 64.210000 | 64.13 | 63.27 | 64.01 | 64.98 | 66.77 | 64.734000 |
| Arensito | 64.92 | 64.45 | 64.65 | 64.673333 | 64.34 | 63.51 | 66.05 | 65.64 | 68.90 | 65.837667 |
| MTGAP "ergonomic" | 64.99 | 64.95 | 63.66 | 64.533333 | 66.20 | 66.25 | 64.81 | 66.23 | 66.72 | 65.703667 |
| White | 65.10 | 63.99 | 64.18 | 64.423333 | 70.50 | 71.32 | 68.09 | 66.50 | 69.55 | 67.894667 |
| full-maks-minimo | 65.37 | 64.62 | 64.61 | 64.866667 | 67.15 | 66.82 | 68.27 | 67.80 | 67.29 | 67.042333 |
| Kaehi | 65.56 | 64.18 | 64.33 | 64.690000 | 66.59 | 66.14 | 65.92 | 67.83 | 67.94 | 66.549000 |
| x1 | 65.63 | 64.86 | 64.79 | 65.093333 | 66.86 | 66.89 | 66.28 | 68.03 | 67.91 | 66.837667 |
| Colemak DHk | 65.71 | 65.28 | 64.51 | 65.166667 | 66.29 | 66.26 | 65.67 | 65.43 | 68.46 | 66.200333 |
| Workman | 65.83 | 65.50 | 64.65 | 65.326667 | 68.30 | 68.11 | 66.85 | 66.93 | 71.31 | 67.724333 |
| MTGAP "standard" | 65.84 | 65.24 | 64.52 | 65.200000 | 65.41 | 64.89 | 64.43 | 66.78 | 66.74 | 65.660000 |
| Soul mod | 65.89 | 65.52 | 64.67 | 65.360000 | 66.25 | 65.83 | 64.71 | 64.38 | 68.37 | 65.772000 |
| BEAKL 19 | 65.98 | 64.99 | 64.75 | 65.240000 | 66.47 | 65.20 | 66.12 | 66.99 | 68.85 | 66.607000 |
| MTGAP "shortcuts" | 66.02 | 65.58 | 64.74 | 65.446667 | 64.73 | 64.45 | 62.72 | 65.44 | 66.34 | 64.907333 |
| uciea-gcsv | 66.22 | 65.99 | 66.72 | 66.310000 | 65.30 | 64.68 | 66.55 | 68.09 | 71.39 | 67.466000 |
| BEAKL 19 Opt French | 66.32 | 65.23 | 65.32 | 65.623333 | 66.08 | 64.99 | 65.85 | 65.31 | 69.32 | 66.327667 |
| Uciea | 66.43 | 66.13 | 65.77 | 66.110000 | 66.10 | 66.01 | 65.01 | 65.99 | 68.32 | 66.297000 |
| Oneproduct | 66.44 | 66.06 | 65.38 | 65.960000 | 69.56 | 69.36 | 68.07 | 68.45 | 69.22 | 68.232000 |
| Hands down | 66.64 | 66.19 | 65.51 | 66.113333 | 65.55 | 64.51 | 66.10 | 63.14 | 66.66 | 65.408667 |
| MTGAP "Easy" | 66.78 | 66.43 | 65.71 | 66.306667 | 65.62 | 64.76 | 64.55 | 64.97 | 65.35 | 65.273333 |
| Colemak Angle Mod ANSI | 66.82 | 66.96 | 65.64 | 66.473333 | 65.50 | 64.86 | 65.25 | 66.66 | 68.10 | 66.332667 |
| Colemak Angle Mod ISO | 66.88 | 67.01 | 65.70 | 66.530000 | 65.56 | 64.94 | 65.60 | 67.01 | 68.14 | 66.506000 |
| Colemak | 67.15 | 67.07 | 65.97 | 66.730000 | 65.35 | 64.58 | 65.37 | 67.77 | 68.82 | 66.731000 |
| uciea-pcrw | 67.23 | 67.14 | 66.60 | 66.990000 | 66.45 | 66.19 | 66.07 | 66.62 | 68.80 | 66.960000 |
| Niro mod | 67.41 | 67.38 | 66.36 | 67.050000 | 67.53 | 67.00 | 66.58 | 67.71 | 70.41 | 67.803000 |
| BEAKL 15 | 67.43 | 66.97 | 66.48 | 66.960000 | 67.86 | 66.60 | 66.64 | 69.37 | 68.59 | 67.758000 |
| Halmak | 67.94 | 67.44 | 66.76 | 67.380000 | 68.33 | 68.00 | 66.87 | 69.60 | 70.68 | 68.539000 |
| Three | 68.23 | 67.51 | 67.02 | 67.586667 | 70.62 | 70.32 | 69.46 | 71.00 | 70.95 | 69.893333 |
| Norman | 68.34 | 67.73 | 67.33 | 67.800000 | 71.30 | 70.33 | 71.24 | 69.86 | 72.10 | 70.363000 |
| ASSET | 68.88 | 68.28 | 67.85 | 68.336667 | 66.44 | 65.17 | 66.69 | 70.35 | 71.03 | 68.442333 |
| Notarize | 69.45 | 68.83 | 68.49 | 68.923333 | 67.88 | 66.52 | 67.68 | 69.21 | 67.94 | 68.190667 |
| Capewell-Dvorak | 70.11 | 69.17 | 69.30 | 69.526667 | 74.56 | 74.00 | 74.35 | 70.91 | 75.99 | 73.011333 |
| Optimal digram | 70.64 | 70.21 | 69.64 | 70.163333 | 69.24 | 69.09 | 68.94 | 70.21 | 70.11 | 69.717667 |
| qgmlwyfub | 70.83 | 70.39 | 69.86 | 70.360000 | 72.25 | 73.29 | 70.24 | 72.16 | 73.71 | 71.848000 |
| g-ansi-maks | 70.94 | 70.71 | 70.59 | 70.746667 | 70.99 | 71.03 | 72.39 | 68.91 | 72.73 | 71.157333 |
| qgmlwbyuv | 71.02 | 70.70 | 70.10 | 70.606667 | 72.63 | 73.81 | 70.86 | 74.00 | 74.53 | 72.643333 |
| c-qwerty n | 71.26 | 71.09 | 71.04 | 71.130000 | 68.75 | 67.41 | 70.08 | 72.83 | 75.28 | 71.480000 |
| Klausler | 71.37 | 70.46 | 70.47 | 70.766667 | 73.58 | 72.60 | 74.08 | 73.15 | 73.95 | 73.007333 |
| Qwpr | 71.69 | 71.30 | 70.78 | 71.256667 | 70.50 | 70.68 | 69.44 | 73.07 | 71.69 | 71.209333 |
| Coeur | 72.29 | 72.46 | 71.67 | 72.140000 | 65.11 | 63.93 | 67.07 | 71.04 | 73.48 | 69.650000 |
| B#po keyberon | 72.79 | 72.71 | 71.81 | 72.436667 | 67.10 | 65.86 | 68.53 | 72.07 | 73.49 | 70.601333 |
| qgmlwbyuob | 72.93 | 71.84 | 71.97 | 72.246667 | 76.71 | 77.65 | 75.46 | 72.23 | 73.83 | 74.189333 |
| Minimak-8key | 72.94 | 72.36 | 71.89 | 72.396667 | 71.90 | 71.19 | 71.94 | 75.20 | 73.55 | 72.926333 |
| B#po 40% | 73.20 | 73.19 | 72.36 | 72.916667 | 66.92 | 65.69 | 68.54 | 73.10 | 73.56 | 70.884333 |
| Dvorak | 73.74 | 72.78 | 72.96 | 73.160000 | 75.38 | 73.82 | 75.34 | 74.59 | 78.53 | 75.244000 |
| abKey | 75.13 | 75.36 | 77.62 | 76.036667 | 71.78 | 72.08 | 74.59 | 78.56 | 78.61 | 75.945333 |
| Neo | 76.31 | 75.50 | 75.22 | 75.676667 | 73.86 | 73.34 | 74.56 | 71.62 | 74.16 | 73.923333 |
| Qwkrfy | 78.58 | 77.69 | 77.71 | 77.993333 | 75.99 | 76.68 | 73.60 | 82.41 | 77.83 | 77.633667 |
| c-qwerty | 78.78 | 78.04 | 78.88 | 78.566667 | 76.26 | 74.74 | 78.01 | 84.63 | 84.48 | 80.237333 |
| c-qwerty 0.5 | 86.95 | 86.08 | 87.03 | 86.686667 | 84.51 | 82.25 | 83.82 | 89.65 | 90.83 | 86.873333 |
| Qwertz | 98.56 | 97.63 | 98.43 | 98.206667 | 96.11 | 95.99 | 93.66 | 98.31 | 95.30 | 96.305333 |
| Qwerty Angle Mod | 99.68 | 98.94 | 99.38 | 99.333333 | 96.77 | 96.82 | 92.54 | 99.98 | 95.51 | 96.831667 |
| Qwerty | 100.00 | 99.17 | 99.70 | 99.623333 | 96.94 | 97.10 | 92.45 | 99.74 | 96.08 | 96.982667 |
| Azerty | 105.44 | 104.63 | 105.46 | 105.176667 | 101.13 | 101.56 | 102.40 | 102.81 | 102.72 | 102.890333 |
| ABCDE | 107.36 | 107.68 | 107.21 | 107.416667 | 106.48 | 106.85 | 107.04 | 103.36 | 104.72 | 105.840333 |
| TNWMLC | 128.82 | 130.06 | 129.27 | 129.383333 | 125.40 | 125.68 | 125.31 | 121.88 | 125.59 | 125.540667 |

As the "Colemak DHm" layout gave the most interesting results, a personal modified version was added to replace some characters like `;` (that can be on a layer like Shift + `,`) by the French `é`.

# Conclusion

All the alternative layouts perform very significantly better than the traditional ones (Qwerty and similar). The biggest interest for ergonomics is using an alternative layout at all, the selected choice matters a lot less.

![results](layout_evaluation/results.png "Grades per layout")

The options that perform the best are some Colemak variants like DHm (image below), the obscure [BEAKL 19bis](https://www.reddit.com/r/ErgoDoxEZ/comments/gsvpug/layout_of_the_month_beakl_15/ftcan68/?context=3), the [Engram](https://engram.dev/), as well as the layouts generated by [Mathematical multicore](https://mathematicalmulticore.wordpress.com/) (MTGAP). 

![Colemak DHm](images/ColemakDHm.png "Colemak DHm layout")

In conclusion, the Colemak DHm layout is particularly recommended for its good results and better shortcuts access, familiarity with Qwerty, and larger positive user feedback.